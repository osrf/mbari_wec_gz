// Copyright 2022 Open Source Robotics Foundation, Inc. and Monterey Bay Aquarium Research Institute
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

#ifndef ELECTROHYDRAULICPTO__ELECTROHYDRAULICSOLN_HPP_
#define ELECTROHYDRAULICPTO__ELECTROHYDRAULICSOLN_HPP_

#include <stdio.h>

#include <unsupported/Eigen/NonLinearOptimization>

#include <algorithm>
#include <cmath>
#include <iostream>
#include <memory>
#include <string>
#include <vector>

// Interpolation library for efficiency maps
#include "splinter/datatable.h"
#include "splinter/bspline.h"
#include "splinter/bsplinebuilder.h"

#include "ElectroHydraulicState.hpp"
#include "WindingCurrentTarget.hpp"


/////////////////////////////////////////////////////
// Generic functor
template<typename _Scalar, int NX = Eigen::Dynamic, int NY = Eigen::Dynamic>
struct Functor
{
  typedef _Scalar Scalar;
  enum
  {
    InputsAtCompileTime = NX,
    ValuesAtCompileTime = NY
  };
  typedef Eigen::Matrix<Scalar, InputsAtCompileTime, 1> InputType;
  typedef Eigen::Matrix<Scalar, ValuesAtCompileTime, 1> ValueType;
  typedef Eigen::Matrix<Scalar, ValuesAtCompileTime, InputsAtCompileTime> JacobianType;

  const int m_inputs, m_values;

  Functor()
  : m_inputs(InputsAtCompileTime), m_values(ValuesAtCompileTime)
  {
  }
  Functor(int inputs, int values)
  : m_inputs(inputs), m_values(values)
  {
  }

  int inputs() const {return m_inputs;}
  int values() const {return m_values;}

  // you should define that in the subclass :
  // void operator() (const InputType& x, ValueType* v, JacobianType* _j=0) const;
};


struct ElectroHydraulicSoln : Functor<double>
{
public:
  // Create new DataTable to manage samples
  SPLINTER::DataTable samples_eff_v, samples_eff_m;
  std::unique_ptr<SPLINTER::BSpline> hyd_eff_v, hyd_eff_m;

  // data table and interpolator for relief valve
  SPLINTER::DataTable samples_reliefValve;
  std::unique_ptr<SPLINTER::BSpline> reliefValve;

  // Class that computes Target Winding Current based on RPM, Scale Factor, limits, etc..
  mutable WindingCurrentTarget I_Wind;
  double Q;
  /// \brief Pump/Motor Displacement per Revolution
  double HydMotorDisp;

private:
  // static constexpr double Pset{2000.0};  // 750;  // psi
  // ~50GPM/600psi ~= .33472 in^3/psi -> From SUN RPECLAN data sheet
  // static constexpr double QPerP{(50.0*241.0 / 60.0) / 600.0};
  static const std::vector<double> Prelief;  // {0, Pset, Pset + 600.0};
  static const std::vector<double> Qrelief;  // {0, 0, QPerP*6000.0};

  static const std::vector<double> Peff;  // psi
  static const std::vector<double> Neff;  // rpm

  static const std::vector<std::vector<double>> eff_v;  // volumetric efficiency
  static const std::vector<std::vector<double>> eff_m;  // mechanical efficiency

public:
  ElectroHydraulicSoln()
  : Functor<double>(2, 2)
  {
    // Set HydraulicMotor Volumetric & Mechanical Efficiency
    // Sample the efficiency LUTs
    for (size_t idx = 0U; idx < 22; ++idx) {
      for (size_t jdx = 0U; jdx < 21; ++jdx) {
        // Sample function at x
        SPLINTER::DenseVector x(2);
        x(0) = Neff[idx];
        x(1) = Peff[jdx];
        double eff_v_y = eff_v[jdx][idx];
        double eff_m_y = eff_m[jdx][idx];

        // Store sample
        samples_eff_v.addSample(x, eff_v_y);
        samples_eff_m.addSample(x, eff_m_y);
      }
    }
    // Build B-splines that interpolate the samples
    hyd_eff_v = std::make_unique<SPLINTER::BSpline>(
      SPLINTER::BSpline::Builder(samples_eff_v)
      .degree(1).build());
    hyd_eff_m = std::make_unique<SPLINTER::BSpline>(
      SPLINTER::BSpline::Builder(samples_eff_m)
      .degree(1).build());

    // Set pressure vs flow for relief valve
    for (size_t kdx = 0U; kdx < 3; ++kdx) {
      SPLINTER::DenseVector x(1);
      x(0) = Prelief[kdx];
      double qr_y = Qrelief[kdx];
      samples_reliefValve.addSample(x, qr_y);
    }
    reliefValve = std::make_unique<SPLINTER::BSpline>(
      SPLINTER::BSpline::Builder(samples_reliefValve)
      .degree(1).build());
  }

  // x[0] = RPM
  // x[1] = Pressure (psi)
  int operator()(const Eigen::VectorXd & x, Eigen::VectorXd & fvec) const
  {
    const int n = x.size();
    assert(fvec.size() == n);

    // TODO(hamilton) temporary fix for NaN situation. Should make this more robust
    // or at least parameterized.
    // Problem: If I repeatedly smash the PC with a -30 Amp winding current command, this solution
    // becomes unstable and rpm/pressure reach NaN and gazebo crashes. I'm clipping it
    // to the max absolute rpm from the winding current interpolation
    // (no extrapolation, default torque controller).
    // const double rpm = std::min(std::max(x[0U], -6790.0), 6790.0);

    SPLINTER::DenseVector sample(2);
    sample(0) = fabs(x[0U]);  // rpm
    sample(1) = fabs(x[1U]);  // pressure
    const double eff_m = this->hyd_eff_m->eval(sample);
    const double eff_v = this->hyd_eff_v->eval(sample);

    // 1.375 fudge factor required to match experiments, not yet sure why.
    const double T_applied = 1.375 * this->I_Wind.TorqueConstantInLbPerAmp * this->I_Wind(x[0U]);

    static constexpr double Pset = 2925;
    double QQ = this->Q;
    if (x[1] > Pset) {   // Extending
      QQ += (x[1] - Pset) * (50 * 241 / 60) / 600;  // TODO(hamilton) magic numbers
    }
    // SPLINTER::DenseVector sample_rv(1);
    // sample_rv(0) = x[1];
    // QQ += this->reliefValve->eval(sample_rv);

    fvec[0] = x[0] - eff_v * 60.0 * QQ / this->HydMotorDisp;
    fvec[1] = x[1] - eff_m * T_applied / (this->HydMotorDisp / (2 * M_PI));

    return 0;
  }
};

// {0, Pset, Pset + 600.0};
const std::vector<double> ElectroHydraulicSoln::Prelief{0.0, 2800.0, 3000.0};
// {0, 0, QPerP*6000.0};
const std::vector<double> ElectroHydraulicSoln::Qrelief{1.0, 1.0, 0.0};

const std::vector<double> ElectroHydraulicSoln::Peff
{0.0, 145.0, 290.0, 435.0, 580.0, 725.0,
  870.0, 1015.0, 1160.0, 1305.0, 1450.0,
  1595.0, 1740.0, 1885.0, 2030.0, 2175.0,
  2320.0, 2465.0, 2610.0, 2755.0, 2900.0};

/*{0, 1000000, 2000000, 3000000, 4000000, 5000000, 6000000, 7000000,
  8000000, 9000000, 10000000, 11000000, 12000000, 13000000, 14000000,
  15000000, 16000000, 17000000, 18000000, 19000000, 20000000};*/
// {0, 145, 290, 435, 580, 725, 870, 1015, 1160, 1305, 1450, 2176, 2901};

const std::vector<double> ElectroHydraulicSoln::Neff
{0.0, 100.0, 200.0, 300.0, 400.0, 500.0, 600.0, 700.0, 800.0, 900.0, 1000.0, 1500.0,
  2000.0, 2500.0, 3000.0, 3500.0, 4000.0, 4500.0, 5000.0, 5500.0, 6000.0, 15000.0};

/*
const std::vector<std::vector<double>> ElectroHydraulicSoln::Neff
{
  {0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1500, 2000, 2500, 3000, 3500,
    4000, 4500, 5000, 5500, 6000, 15000},  // 0Mpa/0psi
  {0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1500, 2000, 2500, 3000, 3500,
    4000, 4500, 5000, 5500, 6000, 15000},  // 1Mpa/145psi
  {0, 1500, 2000, 2500, 3000, 3500, 4000, 4500, 5000, 5500, 6000, 15000},  // 2Mpa/290psi
  {0, 1500, 2000, 2500, 3000, 3500, 4000, 4500, 5000, 5500, 6000, 15000},  // 3Mpa/435psi
  {0, 1500, 2000, 2500, 3000, 3500, 4000, 4500, 5000, 5500, 6000, 15000},  // 4Mpa/580psi
  {0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1500, 2000, 2500, 3000, 3500,
    4000, 4500, 5000, 5500, 6000, 15000},  // 5Mpa/725psi
  {0, 1500, 2000, 2500, 3000, 3500, 4000, 4500, 5000, 5500, 6000, 15000},  // 6Mpa/870psi
  {0, 1500, 2000, 2500, 3000, 3500, 4000, 4500, 5000, 5500, 6000, 15000},  // 7Mpa/1015psi
  {0, 1500, 2000, 2500, 3000, 3500, 4000, 4500, 5000, 5500, 6000, 15000},  // 8Mpa/1160psi
  {0, 1500, 2000, 2500, 3000, 3500, 4000, 4500, 5000, 5500, 6000, 15000},  // 9Mpa/1305psi
  {0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1500, 2000, 2500, 3000, 3500,
    4000, 4500, 5000, 5500, 6000, 15000},  // 10Mpa/1450psi
  {0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1500, 2000, 2500, 3000, 3500,
    4000, 4500, 5000, 5500, 6000, 15000},  // 15Mpa/2176psi
  {0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1500, 2000, 2500, 3000, 3500,
    4000, 4500, 5000, 5500, 6000, 15000}  // 20Mpa/2901psi
};
*/

const std::vector<std::vector<double>> ElectroHydraulicSoln::eff_v
{
  {0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000,
    0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000},
  {0.1000, 0.9700, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9900, 0.9900,
    0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900},
  {0.1000, 0.9525, 0.9700, 0.9750, 0.9750, 0.9775, 0.9775, 0.9775, 0.9800, 0.9800, 0.9875, 0.9800,
    0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900},
  {0.1000, 0.9350, 0.9600, 0.9700, 0.9700, 0.9750, 0.9750, 0.9750, 0.9800, 0.9800, 0.9850, 0.9800,
    0.9800, 0.9800, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900},
  {0.1000, 0.9175, 0.9500, 0.9650, 0.9650, 0.9725, 0.9725, 0.9725, 0.9800, 0.9800, 0.9825, 0.9800,
    0.9800, 0.9800, 0.9800, 0.9800, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900, 0.9900},
  {0.1000, 0.9000, 0.9400, 0.9600, 0.9600, 0.9700, 0.9700, 0.9700, 0.9800, 0.9800, 0.9800, 0.9800,
    0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9900, 0.9900, 0.9900, 0.9900},
  {0.1000, 0.8860, 0.9320, 0.9540, 0.9560, 0.9660, 0.9680, 0.9680, 0.9760, 0.9780, 0.9780, 0.9800,
    0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9900, 0.9800},
  {0.1000, 0.8720, 0.9240, 0.9480, 0.9520, 0.9620, 0.9660, 0.9660, 0.9720, 0.9760, 0.9760, 0.9800,
    0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800},
  {0.1000, 0.8580, 0.9160, 0.9420, 0.9480, 0.9580, 0.9640, 0.9640, 0.9680, 0.9740, 0.9740, 0.9800,
    0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800},
  {0.1000, 0.8440, 0.9080, 0.9360, 0.9440, 0.9540, 0.9620, 0.9620, 0.9640, 0.9720, 0.9720, 0.9800,
    0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800},
  {0.1000, 0.8300, 0.9000, 0.9300, 0.9400, 0.9500, 0.9600, 0.9600, 0.9600, 0.9700, 0.9700, 0.9700,
    0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800},
  {0.1000, 0.8180, 0.8940, 0.9240, 0.9360, 0.9460, 0.9560, 0.9580, 0.9580, 0.9680, 0.9680, 0.9680,
    0.9760, 0.9760, 0.9760, 0.9760, 0.9760, 0.9760, 0.9760, 0.9760, 0.9760, 0.9760},
  {0.1000, 0.8060, 0.8880, 0.9180, 0.9320, 0.9420, 0.9520, 0.9560, 0.9560, 0.9660, 0.9660, 0.9660,
    0.9720, 0.9720, 0.9720, 0.9720, 0.9720, 0.9720, 0.9720, 0.9720, 0.9720, 0.9720},
  {0.1000, 0.7940, 0.8820, 0.9120, 0.9280, 0.9380, 0.9480, 0.9540, 0.9540, 0.9640, 0.9640, 0.9640,
    0.9680, 0.9680, 0.9680, 0.9680, 0.9680, 0.9680, 0.9680, 0.9680, 0.9680, 0.9680},
  {0.1000, 0.7820, 0.8760, 0.9060, 0.9240, 0.9340, 0.9440, 0.9520, 0.9520, 0.9620, 0.9620, 0.9620,
    0.9640, 0.9640, 0.9640, 0.9640, 0.9640, 0.9640, 0.9640, 0.9640, 0.9640, 0.9640},
  {0.1000, 0.7700, 0.8700, 0.9000, 0.9200, 0.9300, 0.9400, 0.9500, 0.9500, 0.9600, 0.9600, 0.9600,
    0.9600, 0.9600, 0.9600, 0.9600, 0.9600, 0.9600, 0.9600, 0.9600, 0.9600, 0.9600},
  {0.1000, 0.7600, 0.8620, 0.8960, 0.9160, 0.9280, 0.9380, 0.9480, 0.9480, 0.9580, 0.9580, 0.9580,
    0.9580, 0.9580, 0.9580, 0.9580, 0.9580, 0.9580, 0.9580, 0.9580, 0.9580, 0.9580},
  {0.1000, 0.7500, 0.8540, 0.8920, 0.9120, 0.9260, 0.9360, 0.9460, 0.9460, 0.9560, 0.9560, 0.9560,
    0.9560, 0.9560, 0.9560, 0.9560, 0.9560, 0.9560, 0.9560, 0.9560, 0.9560, 0.9560},
  {0.1000, 0.7400, 0.8460, 0.8880, 0.9080, 0.9240, 0.9340, 0.9440, 0.9440, 0.9540, 0.9540, 0.9540,
    0.9540, 0.9540, 0.9540, 0.9540, 0.9540, 0.9540, 0.9540, 0.9540, 0.9540, 0.9540},
  {0.1000, 0.7300, 0.8380, 0.8840, 0.9040, 0.9220, 0.9320, 0.9420, 0.9420, 0.9520, 0.9520, 0.9520,
    0.9520, 0.9520, 0.9520, 0.9520, 0.9520, 0.9520, 0.9520, 0.9520, 0.9520, 0.9520},
  {0.1000, 0.7200, 0.8300, 0.8800, 0.9000, 0.9200, 0.9300, 0.9400, 0.9400, 0.9500, 0.9500, 0.9500,
    0.9500, 0.9500, 0.9500, 0.9500, 0.9500, 0.9500, 0.9500, 0.9500, 0.9500, 0.9500}
};

const std::vector<std::vector<double>> ElectroHydraulicSoln::eff_m
{
  {0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000,
    0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000, 0.1000},
  {0.6000, 0.6000, 0.6100, 0.6200, 0.6300, 0.6400, 0.6500, 0.6500, 0.6600, 0.6600, 0.6700, 0.7900,
    0.7900, 0.7800, 0.7700, 0.7400, 0.7100, 0.6800, 0.6400, 0.6000, 0.5500, 0.1500},
  {0.6800, 0.6800, 0.6900, 0.6975, 0.7050, 0.7125, 0.7200, 0.7200, 0.7275, 0.7275, 0.7350, 0.8400,
    0.8400, 0.8400, 0.8200, 0.8100, 0.7800, 0.7600, 0.7300, 0.7000, 0.6600, 0.3500},
  {0.7600, 0.7600, 0.7700, 0.7750, 0.7800, 0.7850, 0.7900, 0.7900, 0.7950, 0.7950, 0.8000, 0.8900,
    0.8900, 0.8900, 0.8800, 0.8700, 0.8500, 0.8400, 0.8200, 0.8000, 0.7700, 0.5500},
  {0.8400, 0.8400, 0.8500, 0.8525, 0.8550, 0.8575, 0.8600, 0.8600, 0.8625, 0.8625, 0.8650, 0.9200,
    0.9200, 0.9200, 0.9100, 0.9000, 0.8900, 0.8800, 0.8600, 0.8400, 0.8300, 0.7000},
  {0.9200, 0.9200, 0.9300, 0.9300, 0.9300, 0.9300, 0.9300, 0.9300, 0.9300, 0.9300, 0.9300, 0.9400,
    0.9400, 0.9300, 0.9300, 0.9200, 0.9100, 0.9000, 0.8900, 0.8700, 0.8600, 0.8000},
  {0.9280, 0.9280, 0.9360, 0.9380, 0.9380, 0.9380, 0.9380, 0.9380, 0.9380, 0.9380, 0.9380, 0.9500,
    0.9500, 0.9400, 0.9400, 0.9300, 0.9200, 0.9200, 0.9100, 0.8900, 0.8800, 0.8200},
  {0.9360, 0.9360, 0.9420, 0.9460, 0.9460, 0.9460, 0.9460, 0.9460, 0.9460, 0.9460, 0.9460, 0.9500,
    0.9500, 0.9500, 0.9500, 0.9400, 0.9300, 0.9300, 0.9200, 0.9100, 0.9000, 0.8400},
  {0.9440, 0.9440, 0.9480, 0.9540, 0.9540, 0.9540, 0.9540, 0.9540, 0.9540, 0.9540, 0.9540, 0.9600,
    0.9600, 0.9600, 0.9500, 0.9500, 0.9400, 0.9400, 0.9300, 0.9200, 0.9100, 0.8500},
  {0.9520, 0.9520, 0.9540, 0.9620, 0.9620, 0.9620, 0.9620, 0.9620, 0.9620, 0.9620, 0.9620, 0.9600,
    0.9600, 0.9600, 0.9600, 0.9500, 0.9500, 0.9400, 0.9300, 0.9300, 0.9200, 0.8600},
  {0.9600, 0.9600, 0.9600, 0.9700, 0.9700, 0.9700, 0.9700, 0.9700, 0.9700, 0.9700, 0.9700, 0.9700,
    0.9700, 0.9700, 0.9600, 0.9600, 0.9500, 0.9500, 0.9400, 0.9300, 0.9300, 0.8800},
  {0.9640, 0.9640, 0.9640, 0.9720, 0.9720, 0.9720, 0.9720, 0.9720, 0.9720, 0.9720, 0.9720, 0.9700,
    0.9700, 0.9700, 0.9600, 0.9600, 0.9500, 0.9500, 0.9400, 0.9300, 0.9300, 0.8820},
  {0.9680, 0.9680, 0.9680, 0.9740, 0.9740, 0.9740, 0.9740, 0.9740, 0.9740, 0.9740, 0.9740, 0.9700,
    0.9700, 0.9700, 0.9600, 0.9600, 0.9500, 0.9500, 0.9400, 0.9300, 0.9300, 0.8840},
  {0.9720, 0.9720, 0.9720, 0.9760, 0.9760, 0.9760, 0.9760, 0.9760, 0.9760, 0.9760, 0.9760, 0.9700,
    0.9700, 0.9700, 0.9600, 0.9600, 0.9500, 0.9500, 0.9400, 0.9300, 0.9300, 0.8860},
  {0.9760, 0.9760, 0.9760, 0.9780, 0.9780, 0.9780, 0.9780, 0.9780, 0.9780, 0.9780, 0.9780, 0.9700,
    0.9700, 0.9700, 0.9600, 0.9600, 0.9500, 0.9500, 0.9400, 0.9300, 0.9300, 0.8880},
  {0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9700,
    0.9700, 0.9700, 0.9600, 0.9600, 0.9500, 0.9500, 0.9400, 0.9300, 0.9300, 0.8900},
  {0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9700,
    0.9700, 0.9700, 0.9600, 0.9600, 0.9500, 0.9500, 0.9400, 0.9300, 0.9300, 0.8920},
  {0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9700,
    0.9700, 0.9700, 0.9600, 0.9600, 0.9500, 0.9500, 0.9400, 0.9300, 0.9300, 0.8940},
  {0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9700,
    0.9700, 0.9700, 0.9600, 0.9600, 0.9500, 0.9500, 0.9400, 0.9300, 0.9300, 0.8960},
  {0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9700,
    0.9700, 0.9700, 0.9600, 0.9600, 0.9500, 0.9500, 0.9400, 0.9300, 0.9300, 0.8980},
  {0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9800, 0.9700,
    0.9700, 0.9700, 0.9600, 0.9600, 0.9500, 0.9500, 0.9400, 0.9300, 0.9300, 0.9000},
};

/*
const std::vector<std::vector<double>> ElectroHydraulicSoln::eff_v
{
  // {0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10,
  //  0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10},  // 0Mpa/0psi
  {0.97, 0.97, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.99, 0.99, 0.99, 0.99, 0.99,
    0.99, 0.99, 0.99, 0.99, 0.99, 0.99, 0.99},  // 1Mpa/145psi
  {0.97, 0.97, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.99, 0.99, 0.99, 0.99, 0.99,
    0.99, 0.99, 0.99, 0.99, 0.99, 0.99, 0.99},  // 1Mpa/145psi
  {0.98, 0.98, 0.99, 0.99, 0.99, 0.99, 0.99, 0.99, 0.99, 0.99, 0.99, 0.99},  // 2Mpa/290psi
  {0.98, 0.98, 0.98, 0.98, 0.99, 0.99, 0.99, 0.99, 0.99, 0.99, 0.99, 0.99},  // 3Mpa/435psi
  {0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.99, 0.99, 0.99, 0.99, 0.99, 0.99},  // 4Mpa/580psi
  {0.90, 0.90, 0.94, 0.96, 0.96, 0.97, 0.97, 0.97, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98,
    0.98, 0.98, 0.98, 0.99, 0.99, 0.99, 0.99},  // 5Mpa/725psi
  {0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.99, 0.98},  // 6Mpa/870psi
  {0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98},  // 7Mpa/1015psi
  {0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98},  // 8Mpa/1160psi
  {0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98},  // 9Mpa/1305psi
  {0.83, 0.83, 0.90, 0.93, 0.94, 0.95, 0.96, 0.96, 0.96, 0.97, 0.97, 0.97, 0.98, 0.98, 0.98,
    0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98},  // 10Mpa/1450psi
  {0.77, 0.77, 0.87, 0.90, 0.92, 0.93, 0.94, 0.95, 0.95, 0.96, 0.96, 0.96, 0.96, 0.96, 0.96,
    0.96, 0.96, 0.96, 0.96, 0.96, 0.96, 0.96},  // 15Mpa/2176psi
  {0.72, 0.72, 0.83, 0.88, 0.90, 0.92, 0.93, 0.94, 0.94, 0.95, 0.95, 0.95, 0.95, 0.95, 0.95,
    0.95, 0.95, 0.95, 0.95, 0.95, 0.95, 0.95}  // 20Mpa/2901psi
};
const std::vector<std::vector<double>> ElectroHydraulicSoln::eff_m
{
  // {0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10,
  //  0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10},  // 0Mpa/0psi
  {0.60, 0.60, 0.61, 0.62, 0.63, 0.64, 0.65, 0.65, 0.66, 0.66, 0.67, 0.79, 0.79, 0.78, 0.77,
    0.74, 0.71, 0.68, 0.64, 0.60, 0.55, 0.15},  // 1Mpa/145psi
  {0.60, 0.60, 0.61, 0.62, 0.63, 0.64, 0.65, 0.65, 0.66, 0.66, 0.67, 0.79, 0.79, 0.78, 0.77,
    0.74, 0.71, 0.68, 0.64, 0.60, 0.55, 0.15},  // 1Mpa/145psi
  {0.84, 0.84, 0.84, 0.84, 0.82, 0.81, 0.78, 0.76, 0.73, 0.70, 0.66, 0.35},  // 2Mpa/290psi
  {0.89, 0.89, 0.89, 0.89, 0.88, 0.87, 0.85, 0.84, 0.82, 0.80, 0.77, 0.55},  // 3Mpa/435psi
  {0.92, 0.92, 0.92, 0.92, 0.91, 0.90, 0.89, 0.88, 0.86, 0.84, 0.83, 0.70},  // 4Mpa/580psi
  {0.92, 0.92, 0.93, 0.93, 0.93, 0.93, 0.93, 0.93, 0.93, 0.93, 0.93, 0.94, 0.94, 0.93, 0.93,
    0.92, 0.91, 0.90, 0.89, 0.87, 0.86, 0.80},  // 5Mpa/725psi
  {0.95, 0.95, 0.95, 0.94, 0.94, 0.93, 0.92, 0.92, 0.91, 0.89, 0.88, 0.82},  // 6Mpa/870psi
  {0.95, 0.95, 0.95, 0.95, 0.95, 0.94, 0.93, 0.93, 0.92, 0.91, 0.90, 0.84},  // 7Mpa/1015psi
  {0.96, 0.96, 0.96, 0.96, 0.95, 0.95, 0.94, 0.94, 0.93, 0.92, 0.91, 0.85},  // 8Mpa/1160psi
  {0.96, 0.96, 0.96, 0.96, 0.96, 0.95, 0.95, 0.94, 0.93, 0.93, 0.92, 0.86},  // 9Mpa/1305psi
  {0.96, 0.96, 0.96, 0.97, 0.97, 0.97, 0.97, 0.97, 0.97, 0.97, 0.97, 0.97, 0.97, 0.97, 0.96,
    0.96, 0.95, 0.95, 0.94, 0.93, 0.93, 0.88},  // 10Mpa/1450psi
  {0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.97, 0.97, 0.97, 0.96,
    0.96, 0.95, 0.95, 0.94, 0.93, 0.93, 0.89},  // 15Mpa/2176psi
  {0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.98, 0.97, 0.97, 0.97, 0.96,
    0.96, 0.95, 0.95, 0.94, 0.93, 0.93, 0.90}  // 20Mpa/2901psi
};
*/

#endif  // ELECTROHYDRAULICPTO__ELECTROHYDRAULICSOLN_HPP_
